# Intro

- Malware analysis is a form of incident response
- When analysing malware, we consider the following
  - POE : point of entry
  - The indicators that a malware is running on the machine
  - How does the malware perform ? does it try to spread to other machines on the network or encrypt any files ... etc
  - Most importantly, can we ultimately prevent or at least detect any further infection

# Malware campaigns

There are two main types, targeted and mass campaigns.

- targeted : example stuxnet attack on iran's nuclear infrastructure
- mass : example wannacry ransomware

# Identifying if a malware attack has happened

- Malware ( usually )is largely obtrusive, it leave a lot of evidence behind it
- the process of a malware attack can be broken into a few steps :
  - delivery : could be of many methods : usb, phishing, trojan...
  - execution : The main part where we classify the type of the malware (ransomware, spyware ...)
  - persistence : will the malware persist if the machine restarted
  - propagation to other machines.
    The last 2 steps do not always occur.  
    These steps always generate a lot of data and network traffic and file system reads/write to not get noticed.
- Malware also leave some "fingerprints" behind it :
  - host-based signatures : These are generally speaking the results of execution and any persistence performed by the Malware. For example, has a file been encrypted? Has any additional software been installed?
  - network-based signatures : this classification of signatures are the observation of any networking communication taking place during delivery, execution and propagation. For example, in Ransomware, where has the Malware contacted for Bitcoin payments? Such as in the case of Wannacry, looking for a large amount of "Samba" Protocol communication attempts is a great indication of infection due to its use of the "Eternalblue" vulnerability.

# Types of malware analysis

- static and dynamic
  some tools overlap between the 2 types.

## Recognition of malware

- Checksums : websites like www.virustotal.com/gui have a large database of hashes for common malware, if you felt like a file is a potential malware calculate its checksum and see if it exists in the db.

## Identifying if an exe is packed / obfuscated

- sometimes a file might have t a .jpg file extension and still be an executable, to know wether a file is exe or not, we need to headers (the same as magic numbers ? idk), the hex file header for an exe is always 4D 5A, so if a jpg file has this header it's an exe.
- example of tools : peid., packing is a form of obfuscation. tools like peid
- peid can only tell if an exe has been obfuscated/packed, to actually depack it we need to use a disassembler like ida
- packed code is much more concise than unpacked code

## Strings

Hard coded ASCII content that we find when decompiling an exe can be helpful to know more about the malware is trying to do, the unix 'string' command takes an exe as a param and returns all the strings with a length > 4. and its up to use to determine what they mean
